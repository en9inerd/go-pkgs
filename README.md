# go-pkgs

Go library for personal use.  
A collection of utility packages, helpers, and experiments written in Go.

## Documentation

The package documentation is auto-generated using [gomarkdoc](https://github.com/princjef/gomarkdoc).

<!-- gomarkdoc:embed:start -->

<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# middleware

```go
import "github.com/en9inerd/go-pkgs/middleware"
```

## Index

- [func GlobalThrottle\(limit int64\) func\(http.Handler\) http.Handler](<#GlobalThrottle>)
- [func Headers\(headers ...string\) func\(http.Handler\) http.Handler](<#Headers>)
- [func Health\(next http.Handler\) http.Handler](<#Health>)
- [func Logger\(logger \*slog.Logger\) func\(http.Handler\) http.Handler](<#Logger>)
- [func RealIP\(h http.Handler\) http.Handler](<#RealIP>)
- [func Recoverer\(logger \*slog.Logger\) func\(http.Handler\) http.Handler](<#Recoverer>)
- [func SizeLimit\(size int64, logger \*slog.Logger\) func\(http.Handler\) http.Handler](<#SizeLimit>)
- [func Timeout\(timeout time.Duration\) func\(http.Handler\) http.Handler](<#Timeout>)
- [type HealthResponse](<#HealthResponse>)


<a name="GlobalThrottle"></a>
## func GlobalThrottle

```go
func GlobalThrottle(limit int64) func(http.Handler) http.Handler
```

GlobalThrottle returns a middleware that limits the total number of in\-flight requests across all routes in the server.

<a name="Headers"></a>
## func Headers

```go
func Headers(headers ...string) func(http.Handler) http.Handler
```

Headers middleware adds headers to response

<a name="Health"></a>
## func Health

```go
func Health(next http.Handler) http.Handler
```



<a name="Logger"></a>
## func Logger

```go
func Logger(logger *slog.Logger) func(http.Handler) http.Handler
```

Logger middleware using slog

<a name="RealIP"></a>
## func RealIP

```go
func RealIP(h http.Handler) http.Handler
```

RealIP is a middleware that sets a http.Request's RemoteAddr to the results of parsing either the X\-Forwarded\-For or X\-Real\-IP headers.

This middleware should only be used if user can trust the headers sent with request. If reverse proxies are configured to pass along arbitrary header values from the client, or if this middleware used without a reverse proxy, malicious clients could set anything as X\-Forwarded\-For header and attack the server in various ways.

<a name="Recoverer"></a>
## func Recoverer

```go
func Recoverer(logger *slog.Logger) func(http.Handler) http.Handler
```

Recoverer is a middleware that recovers from panics, logs the panic and returns a HTTP 500 status if possible.

<a name="SizeLimit"></a>
## func SizeLimit

```go
func SizeLimit(size int64, logger *slog.Logger) func(http.Handler) http.Handler
```

SizeLimit middleware rejects requests with bodies larger than size.

<a name="Timeout"></a>
## func Timeout

```go
func Timeout(timeout time.Duration) func(http.Handler) http.Handler
```

Timeout creates a timeout middleware

<a name="HealthResponse"></a>
## type HealthResponse



```go
type HealthResponse struct {
    Status string `json:"status"`
}
```

# realip

```go
import "github.com/en9inerd/go-pkgs/realip"
```

## Index

- [func Get\(r \*http.Request\) \(string, error\)](<#Get>)


<a name="Get"></a>
## func Get

```go
func Get(r *http.Request) (string, error)
```

Get extracts the "real" client IP from the request. It prefers the first public IP found scanning headers right\-to\-left, falls back to the first valid IP seen in headers, then to RemoteAddr.

# router

```go
import "github.com/en9inerd/go-pkgs/router"
```

Package router provides a simple way to group routes and apply middleware using Go's standard http.ServeMux \(Go 1.22\+\). It supports:

- Grouping routes under a common base path
- Attaching middleware stacks at the root or per group
- Mounting static file handlers
- Registering handlers with or without HTTP method prefixes
- Defining custom NotFound \(404\) handlers

Example usage:

```
mux := http.NewServeMux()
r := router.New(mux)

// global middleware
r.Use(loggingMiddleware)

// mount API group
api := r.Mount("/api")
api.HandleFunc("/ping", func(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte("pong"))
})

// serve
http.ListenAndServe(":8080", r)
```

Middleware added to the root group executes for every request. Middleware added to a subgroup executes only for that group's routes. The order of middleware application is the same as the order they are added, i.e. first added runs outermost.

Route patterns may be plain paths \("/foo"\) or include an HTTP method prefix \("GET /foo"\). Root "/" patterns are normalized to "/\{$\}" to avoid acting as a catch\-all.

Package router provides a way to group routes and apply middleware. Works with Go's standard http.ServeMux \(Go 1.22\+\).

## Index

- [func Wrap\(handler http.Handler, mw1 func\(http.Handler\) http.Handler, mws ...func\(http.Handler\) http.Handler\) http.Handler](<#Wrap>)
- [type Group](<#Group>)
  - [func New\(mux \*http.ServeMux\) \*Group](<#New>)
  - [func RootGroup\(mux \*http.ServeMux, basePath string\) \*Group](<#RootGroup>)
  - [func \(g \*Group\) DisableNotFoundHandler\(\)](<#Group.DisableNotFoundHandler>)
  - [func \(g \*Group\) Group\(\) \*Group](<#Group.Group>)
  - [func \(g \*Group\) Handle\(pattern string, handler http.Handler\)](<#Group.Handle>)
  - [func \(g \*Group\) HandleFiles\(pattern string, root http.FileSystem\)](<#Group.HandleFiles>)
  - [func \(g \*Group\) HandleFunc\(pattern string, handler http.HandlerFunc\)](<#Group.HandleFunc>)
  - [func \(g \*Group\) HandleRoot\(method string, handler http.Handler\)](<#Group.HandleRoot>)
  - [func \(g \*Group\) HandleRootFunc\(method string, handler http.HandlerFunc\)](<#Group.HandleRootFunc>)
  - [func \(g \*Group\) Handler\(r \*http.Request\) \(h http.Handler, pattern string\)](<#Group.Handler>)
  - [func \(g \*Group\) Mount\(basePath string\) \*Group](<#Group.Mount>)
  - [func \(g \*Group\) NotFoundHandler\(handler http.HandlerFunc\)](<#Group.NotFoundHandler>)
  - [func \(g \*Group\) Route\(fn func\(\*Group\)\)](<#Group.Route>)
  - [func \(g \*Group\) ServeHTTP\(w http.ResponseWriter, r \*http.Request\)](<#Group.ServeHTTP>)
  - [func \(g \*Group\) Use\(mw func\(http.Handler\) http.Handler, more ...func\(http.Handler\) http.Handler\)](<#Group.Use>)
  - [func \(g \*Group\) With\(mw func\(http.Handler\) http.Handler, more ...func\(http.Handler\) http.Handler\) \*Group](<#Group.With>)


<a name="Wrap"></a>
## func Wrap

```go
func Wrap(handler http.Handler, mw1 func(http.Handler) http.Handler, mws ...func(http.Handler) http.Handler) http.Handler
```

Wrap applies middleware\(s\) around a handler.

<a name="Group"></a>
## type Group

Group represents a collection of routes with optional middleware.

```go
type Group struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func New

```go
func New(mux *http.ServeMux) *Group
```

New creates a new root Group bound to the given mux.

<a name="RootGroup"></a>
### func RootGroup

```go
func RootGroup(mux *http.ServeMux, basePath string) *Group
```

Mount creates a new group with a base path.

<a name="Group.DisableNotFoundHandler"></a>
### func \(\*Group\) DisableNotFoundHandler

```go
func (g *Group) DisableNotFoundHandler()
```

DisableNotFoundHandler is a no\-op kept for API compatibility.

<a name="Group.Group"></a>
### func \(\*Group\) Group

```go
func (g *Group) Group() *Group
```

Group creates a new subgroup with the same middleware stack.

<a name="Group.Handle"></a>
### func \(\*Group\) Handle

```go
func (g *Group) Handle(pattern string, handler http.Handler)
```

Handle registers a route with middlewares applied.

<a name="Group.HandleFiles"></a>
### func \(\*Group\) HandleFiles

```go
func (g *Group) HandleFiles(pattern string, root http.FileSystem)
```

HandleFiles serves static files.

<a name="Group.HandleFunc"></a>
### func \(\*Group\) HandleFunc

```go
func (g *Group) HandleFunc(pattern string, handler http.HandlerFunc)
```

HandleFunc registers a route handler function.

<a name="Group.HandleRoot"></a>
### func \(\*Group\) HandleRoot

```go
func (g *Group) HandleRoot(method string, handler http.Handler)
```

HandleRoot registers a handler for the group's root without redirect.

<a name="Group.HandleRootFunc"></a>
### func \(\*Group\) HandleRootFunc

```go
func (g *Group) HandleRootFunc(method string, handler http.HandlerFunc)
```

HandleRootFunc registers a root handler func.

<a name="Group.Handler"></a>
### func \(\*Group\) Handler

```go
func (g *Group) Handler(r *http.Request) (h http.Handler, pattern string)
```

Handler proxies to mux.Handler.

<a name="Group.Mount"></a>
### func \(\*Group\) Mount

```go
func (g *Group) Mount(basePath string) *Group
```

Mount creates a new subgroup with a base path.

<a name="Group.NotFoundHandler"></a>
### func \(\*Group\) NotFoundHandler

```go
func (g *Group) NotFoundHandler(handler http.HandlerFunc)
```

NotFoundHandler sets a custom 404 handler on the root group.

<a name="Group.Route"></a>
### func \(\*Group\) Route

```go
func (g *Group) Route(fn func(*Group))
```

Route configures the group inside the provided function.

<a name="Group.ServeHTTP"></a>
### func \(\*Group\) ServeHTTP

```go
func (g *Group) ServeHTTP(w http.ResponseWriter, r *http.Request)
```

ServeHTTP implements http.Handler for the group.

<a name="Group.Use"></a>
### func \(\*Group\) Use

```go
func (g *Group) Use(mw func(http.Handler) http.Handler, more ...func(http.Handler) http.Handler)
```

Use appends middleware\(s\) to the group.

<a name="Group.With"></a>
### func \(\*Group\) With

```go
func (g *Group) With(mw func(http.Handler) http.Handler, more ...func(http.Handler) http.Handler) *Group
```

With returns a new group with appended middleware\(s\).

# validator

```go
import "github.com/en9inerd/go-pkgs/validator"
```

Package validator provides functionality for validating and sanitizing data.

## Index

- [func Blank\(value string\) bool](<#Blank>)
- [func IsNumber\(value string\) bool](<#IsNumber>)
- [func Matches\(value string, pattern \*regexp.Regexp\) bool](<#Matches>)
- [func MaxChars\(value string, n int\) bool](<#MaxChars>)
- [func MaxDuration\(d, maxDuration time.Duration\) bool](<#MaxDuration>)
- [func MaxFloat\(value, max float64\) bool](<#MaxFloat>)
- [func MaxInt\(value, max int\) bool](<#MaxInt>)
- [func MinChars\(value string, n int\) bool](<#MinChars>)
- [func MinDuration\(d, minDuration time.Duration\) bool](<#MinDuration>)
- [func MinFloat\(value, min float64\) bool](<#MinFloat>)
- [func MinInt\(value, min int\) bool](<#MinInt>)
- [func NotBlank\(value string\) bool](<#NotBlank>)
- [func PermittedValue\[T comparable\]\(value T, permittedValues ...T\) bool](<#PermittedValue>)
- [type Validatable](<#Validatable>)
- [type Validator](<#Validator>)
  - [func \(v \*Validator\) AddFieldError\(key, message string\)](<#Validator.AddFieldError>)
  - [func \(v \*Validator\) AddNonFieldError\(message string\)](<#Validator.AddNonFieldError>)
  - [func \(v \*Validator\) CheckField\(ok bool, key, message string\)](<#Validator.CheckField>)
  - [func \(v \*Validator\) JSON\(\) \[\]byte](<#Validator.JSON>)
  - [func \(v \*Validator\) Valid\(\) bool](<#Validator.Valid>)


<a name="Blank"></a>
## func Blank

```go
func Blank(value string) bool
```

Blank returns true if the string is empty or contains only whitespace.

<a name="IsNumber"></a>
## func IsNumber

```go
func IsNumber(value string) bool
```

IsNumber returns true if the string represents a valid integer.

<a name="Matches"></a>
## func Matches

```go
func Matches(value string, pattern *regexp.Regexp) bool
```

Matches returns true if the string matches the provided regular expression.

<a name="MaxChars"></a>
## func MaxChars

```go
func MaxChars(value string, n int) bool
```

MaxChars returns true if the string contains no more than n characters.

<a name="MaxDuration"></a>
## func MaxDuration

```go
func MaxDuration(d, maxDuration time.Duration) bool
```

MaxDuration returns true if the duration is less than or equal to maxDuration.

<a name="MaxFloat"></a>
## func MaxFloat

```go
func MaxFloat(value, max float64) bool
```

MaxFloat returns true if value is less than or equal to max.

<a name="MaxInt"></a>
## func MaxInt

```go
func MaxInt(value, max int) bool
```

MaxInt returns true if value is less than or equal to max.

<a name="MinChars"></a>
## func MinChars

```go
func MinChars(value string, n int) bool
```

MinChars returns true if the string contains at least n characters.

<a name="MinDuration"></a>
## func MinDuration

```go
func MinDuration(d, minDuration time.Duration) bool
```

MinDuration returns true if the duration is greater than or equal to minDuration.

<a name="MinFloat"></a>
## func MinFloat

```go
func MinFloat(value, min float64) bool
```

MinFloat returns true if value is greater than or equal to min.

<a name="MinInt"></a>
## func MinInt

```go
func MinInt(value, min int) bool
```

MinInt returns true if value is greater than or equal to min.

<a name="NotBlank"></a>
## func NotBlank

```go
func NotBlank(value string) bool
```

NotBlank returns true if the string is not empty or whitespace.

<a name="PermittedValue"></a>
## func PermittedValue

```go
func PermittedValue[T comparable](value T, permittedValues ...T) bool
```

PermittedValue returns true if value is among the provided permittedValues.

<a name="Validatable"></a>
## type Validatable

Validatable defines an interface for structs that can validate themselves using a Validator.

```go
type Validatable interface {
    Validate(v *Validator)
}
```

<a name="Validator"></a>
## type Validator

Validator collects field and non\-field validation errors.

```go
type Validator struct {
    FieldErrors    map[string][]string `json:"fieldErrors"`
    NonFieldErrors []string            `json:"nonFieldErrors"`
}
```

<a name="Validator.AddFieldError"></a>
### func \(\*Validator\) AddFieldError

```go
func (v *Validator) AddFieldError(key, message string)
```

AddFieldError adds an error message to a specific field.

<a name="Validator.AddNonFieldError"></a>
### func \(\*Validator\) AddNonFieldError

```go
func (v *Validator) AddNonFieldError(message string)
```

AddNonFieldError adds a general error message not associated with a specific field.

<a name="Validator.CheckField"></a>
### func \(\*Validator\) CheckField

```go
func (v *Validator) CheckField(ok bool, key, message string)
```

CheckField adds a field error if the provided condition is false.

<a name="Validator.JSON"></a>
### func \(\*Validator\) JSON

```go
func (v *Validator) JSON() []byte
```

JSON returns the validation errors as a JSON byte slice.

<a name="Validator.Valid"></a>
### func \(\*Validator\) Valid

```go
func (v *Validator) Valid() bool
```

Valid returns true if there are no field or non\-field validation errors.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)


<!-- gomarkdoc:embed:end -->

## Usage

```bash
go get github.com/en9inerd/go-pkgs
```

